<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>申请用户 | 手机银行APP云柜文档</title>
    <meta name="description" content="quick start for APP cloud teller workflow ">
    
    
    <link rel="preload" href="/appVideoFlowDoc/assets/css/0.styles.c89d3280.css" as="style"><link rel="preload" href="/appVideoFlowDoc/assets/js/app.35f13f20.js" as="script"><link rel="preload" href="/appVideoFlowDoc/assets/js/2.b1ca60d8.js" as="script"><link rel="preload" href="/appVideoFlowDoc/assets/js/27.e1622741.js" as="script"><link rel="preload" href="/appVideoFlowDoc/assets/js/16.e0a4fa88.js" as="script"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/10.07604a7d.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/11.5b2b976a.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/12.35972648.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/13.8cdd43a4.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/14.68addcac.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/15.1844d6fb.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/17.ca0bf5b2.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/18.54f91839.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/19.c687add5.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/20.f625b327.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/21.4dcf174f.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/22.ccb9c454.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/23.e9ccb295.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/24.74527e2c.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/25.2cfb1549.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/26.012f3180.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/28.21947846.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/29.62ffbc35.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/3.9fbadc31.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/30.b495a823.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/31.d7302fc2.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/32.8b01f34e.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/4.8a2a600a.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/5.8a639e4d.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/6.7af3c09c.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/7.680c50ef.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/8.b519c19a.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/9.7435ab7e.js">
    <link rel="stylesheet" href="/appVideoFlowDoc/assets/css/0.styles.c89d3280.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/appVideoFlowDoc/" class="home-link router-link-active"><!----> <span class="site-name">手机银行APP云柜文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>初识手机云柜</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/appVideoFlowDoc/guide/" class="sidebar-link">介绍</a></li><li><a href="/appVideoFlowDoc/appFlow/" class="sidebar-link">界面操作流程</a></li><li><a href="/appVideoFlowDoc/flowChart/" class="sidebar-link">逻辑流程图</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>视频银行流程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/appVideoFlowDoc/preface/" class="sidebar-link">前言</a></li><li><a href="/appVideoFlowDoc/entrance/" class="sidebar-link">视频入口</a></li><li><a href="/appVideoFlowDoc/startVideo/" class="sidebar-link">发起视频</a></li><li><a href="/appVideoFlowDoc/requestAcct/" class="active sidebar-link">申请用户</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/appVideoFlowDoc/requestAcct/#android-模块调用原理" class="sidebar-link">android 模块调用原理</a></li><li class="sidebar-sub-header"><a href="/appVideoFlowDoc/requestAcct/#anychat-init-初始化" class="sidebar-link">AnyChat.init 初始化</a></li><li class="sidebar-sub-header"><a href="/appVideoFlowDoc/requestAcct/#anychat-enterline-进线" class="sidebar-link">AnyChat.enterLine 进线</a></li><li class="sidebar-sub-header"><a href="/appVideoFlowDoc/requestAcct/#onanychatmessage-anychat消息事件" class="sidebar-link">OnAnyChatMessage anyChat消息事件</a></li></ul></li><li><a href="/appVideoFlowDoc/createVideo/" class="sidebar-link">创建视频</a></li><li><a href="/appVideoFlowDoc/business/" class="sidebar-link">交易流程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>交易开发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/appVideoFlowDoc/workflow/env.html" class="sidebar-link">环境准备</a></li><li><a href="/appVideoFlowDoc/workflow/dev.html" class="sidebar-link">开发</a></li><li><a href="/appVideoFlowDoc/workflow/debug.html" class="sidebar-link">调试</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="android-模块调用原理"><a href="#android-模块调用原理" aria-hidden="true" class="header-anchor">#</a> android 模块调用原理</h2> <p>利用RN框架提供的<code>NativeModules</code>模块，可以直接调用android层的模块。
在js页面中，引用name为<code>AnyChatPlugin</code>的android模块，即封装好的anyChat模块。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//src\pages\activity\home\cloudDots.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NativeModules <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-native'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> AnyChat <span class="token operator">=</span> NativeModules<span class="token punctuation">.</span>AnyChatPlugin
</code></pre></div><p>在android层中，对外暴露一个name为<code>AnyChatPlugin</code>的模块，即可与RN层通信。<div style="display:inline-block;"><button type="button" class="ant-btn ant-btn-primary" style="background-image:linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%);color:black;border:black;"><span>click me</span></button> <!----></div></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//android\react-native-anychat\src\main\java\com\utils\Constant.java</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Constant</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> MODULE_NAME <span class="token operator">=</span> <span class="token string">&quot;AnyChatPlugin&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//android\react-native-anychat\src\main\java\com\AnyChatMoudle.java</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>content</span><span class="token punctuation">.</span><span class="token class-name">SharedPreferences</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge</span><span class="token punctuation">.</span><span class="token class-name">ReactApplicationContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge</span><span class="token punctuation">.</span><span class="token class-name">ReactContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge</span><span class="token punctuation">.</span><span class="token class-name">ReactContextBaseJavaModule</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>module<span class="token punctuation">.</span>annotations</span><span class="token punctuation">.</span><span class="token class-name">ReactModule</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>utils</span><span class="token punctuation">.</span><span class="token class-name">Constant</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@ReactModule</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token class-name">Constant</span><span class="token punctuation">.</span>MODULE_NAME<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnyChatMoudle</span> <span class="token keyword">extends</span> <span class="token class-name">ReactContextBaseJavaModule</span> <span class="token keyword">implements</span> <span class="token class-name">AnyChatTool</span><span class="token punctuation">.</span><span class="token class-name">CallBack</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">ReactApplicationContext</span> mContext<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">AnyChatTool</span> anyChatTool<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">SharedPreferences</span> mShare <span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">AnyChatMoudle</span><span class="token punctuation">(</span><span class="token class-name">ReactApplicationContext</span> reactContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>reactContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mShare <span class="token operator">=</span> reactContext<span class="token punctuation">.</span><span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token string">&quot;round_play_view&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ReactApplicationContext</span><span class="token punctuation">.</span>MODE_PRIVATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mShare<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mContext <span class="token operator">=</span> reactContext<span class="token punctuation">;</span>
        anyChatTool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnyChatTool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AnyChatTool</span><span class="token punctuation">.</span><span class="token function">setCallBack</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="anychat-init-初始化"><a href="#anychat-init-初始化" aria-hidden="true" class="header-anchor">#</a> AnyChat.init 初始化</h2> <p>当RN层调用<code>AnyChat.init</code>时，即调用<code>AnyChatMoudle.java</code>中的<code>init</code>方法。
<code>AnyChatMoudle.java</code>主要用于封装提供给RN的方法，主要处理过程，是在<code>AnyChatTool.java</code>中执行。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//android\react-native-anychat\src\main\java\com\AnyChatMoudle.java</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge</span><span class="token punctuation">.</span><span class="token class-name">ReactMethod</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@ReactMethod</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Callback</span> successCallback<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Callback</span> errorCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">getCurrentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runOnUiThread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">RxPermissions</span><span class="token punctuation">.</span><span class="token function">getIntance</span><span class="token punctuation">(</span><span class="token function">getCurrentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>CAMERA_PERMISSIONS<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Boolean</span> aBoolean<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>aBoolean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                anyChatTool<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token function">getCurrentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> successCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                                errorCallback<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">getErrorWritableMap</span><span class="token punctuation">(</span><span class="token class-name">ConstantPERMISSION_DENIED</span><span class="token punctuation">,</span> <span class="token string">&quot;权限不足&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">return</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//android\react-native-anychat\src\main\java\com\AnyChatTool.java</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Activity</span> context<span class="token punctuation">,</span> <span class="token class-name">Callback</span> successCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>
    sQueueno <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>anyChatSDK <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        anyChatSDK <span class="token operator">=</span> <span class="token class-name">AnyChatCoreSDK</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        anyChatSDK<span class="token punctuation">.</span>mVideoHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyVideoHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        anyChatSDK<span class="token punctuation">.</span><span class="token class-name">SetVideoCallEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        anyChatSDK<span class="token punctuation">.</span><span class="token class-name">SetBaseEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        anyChatSDK<span class="token punctuation">.</span><span class="token class-name">SetTransDataEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        anyChatSDK<span class="token punctuation">.</span><span class="token class-name">InitSDK</span><span class="token punctuation">(</span>android<span class="token punctuation">.</span>os<span class="token punctuation">.</span><span class="token class-name">Build</span><span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        anyChatSDK<span class="token punctuation">.</span>mSensorHelper<span class="token punctuation">.</span><span class="token class-name">InitSensor</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AnyChatCoreSDK</span><span class="token punctuation">.</span><span class="token class-name">SetSDKOptionInt</span><span class="token punctuation">(</span><span class="token class-name">AnyChatDefine</span><span class="token punctuation">.</span>BRAC_SO_LOCALVIDEO_AUTOROTATION<span class="token punctuation">,</span>LOCALVIDEOAUTOROTATION<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">ApplyVideoConfig</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AnyChatCoreSDK</span><span class="token punctuation">.</span><span class="token class-name">SetSDKOptionString</span><span class="token punctuation">(</span><span class="token class-name">AnyChatDefine</span><span class="token punctuation">.</span>BRAC_SO_CLOUD_APPGUID<span class="token punctuation">,</span><span class="token string">&quot;fbe957d1-c25a-4992-9e75-d993294a5d56&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    successCallback<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">AnyChatMoudle</span><span class="token punctuation">.</span><span class="token function">getSuccessWritableMap</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>RESLUT_SUCCESS<span class="token punctuation">,</span> <span class="token string">&quot;成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="anychat-enterline-进线"><a href="#anychat-enterline-进线" aria-hidden="true" class="header-anchor">#</a> AnyChat.enterLine 进线</h2> <p>初始化AnyChat之后，就可以开始申请用户了，这时会传入一些用户数据，其中一个参数<code>enterLineUrl</code>请求地址，经常随环境改变。<div style="display:inline-block;"><button type="button" class="ant-btn ant-btn-primary" style="background-image:linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%);color:black;border:black;"><span>click me</span></button> <!----></div></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> enterLineUrl <span class="token operator">=</span> <span class="token string">'http://192.9.200.11:6030'</span><span class="token punctuation">;</span> <span class="token comment">//云柜基础环境</span>
<span class="token comment">// const enterLineUrl = 'http://192.9.200.44:6030'; //云柜测试环境</span>
<span class="token comment">// const enterLineUrl = 'http://192.9.200.46:6030'; //云柜POC环境</span>
<span class="token function">callCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    AnyChat<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token parameter">succ</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span> <span class="token string">'初始化成功回调'</span><span class="token punctuation">,</span>succ <span class="token punctuation">)</span>
        <span class="token keyword">let</span> businessId <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
            enterLineUrl<span class="token punctuation">:</span> enterLineUrl<span class="token punctuation">,</span>
            businessId<span class="token punctuation">:</span> businessId<span class="token punctuation">,</span>
            <span class="token constant">IDNO</span><span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>userInfoData<span class="token punctuation">.</span>idCard<span class="token punctuation">,</span>
            <span class="token constant">IDTYPE</span><span class="token punctuation">:</span><span class="token string">'02'</span><span class="token punctuation">,</span>
            <span class="token constant">IDNAME</span><span class="token punctuation">:</span>window<span class="token punctuation">.</span>userName
        <span class="token punctuation">}</span>
        AnyChat<span class="token punctuation">.</span><span class="token function">enterLine</span> <span class="token punctuation">(</span> params<span class="token punctuation">,</span> <span class="token punctuation">(</span> <span class="token parameter">succ</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span> <span class="token string">'进线成功回调='</span><span class="token operator">+</span> succ <span class="token punctuation">)</span>
            router<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;tellerOperation&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                account<span class="token punctuation">:</span><span class="token string">&quot;liudabin&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> <span class="token parameter">err</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'进线失败'</span><span class="token punctuation">,</span> err <span class="token punctuation">)</span>
            $Toast<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'呼叫视频服务失败'</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unCallCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> <span class="token parameter">err</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span> err <span class="token punctuation">)</span>
        $Toast<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'呼叫视频服务失败'</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unCallCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在android层，首先会获取用户信息。由于是第一次进线，会申请anyChat用户（<code>que012_esb</code>）用于登录。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//android\react-native-anychat\src\main\java\com\AnyChatMoudle.java</span>
<span class="token annotation punctuation">@ReactMethod</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">enterLine</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">ReadableMap</span> readableMap<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Callback</span> successCallback<span class="token punctuation">,</span> finalCallback errorCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ReadableNativeMap</span> readableNativeMap <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ReadableNativeMap</span><span class="token punctuation">)</span> readableMap<span class="token punctuation">;</span>
    <span class="token class-name">Map</span> map <span class="token operator">=</span> readableNativeMap<span class="token punctuation">.</span><span class="token function">toHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    anyChatTool<span class="token punctuation">.</span>sHostUrl <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;enterLineUrl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    anyChatTool<span class="token punctuation">.</span>sBusinessId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;businessId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    anyChatTool<span class="token punctuation">.</span>IDNO <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;IDNO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    anyChatTool<span class="token punctuation">.</span>IDTYPE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;IDTYPE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    anyChatTool<span class="token punctuation">.</span>IDNAME <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;IDNAME&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>anyChatTool<span class="token punctuation">.</span>isLogin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            anyChatTool<span class="token punctuation">.</span>successCallback <span class="token operator">=</span> successCallback<span class="token punctuation">;</span>
            anyChatTool<span class="token punctuation">.</span>errorCallback <span class="token operator">=</span> errorCallback<span class="token punctuation">;</span>
            anyChatTool<span class="token punctuation">.</span><span class="token function">waitEnterRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            errorCallback<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">getErrorWritableMap</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>RESLUT_ERROR<span class="token punctuation">,</span> <span class="token string">&quot;进线失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">newUser</span><span class="token punctuation">(</span>successCallback<span class="token punctuation">,</span> errorCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JSONException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            errorCallback<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">getErrorWritableMap</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>RESLUT_ERROR<span class="token punctuation">,</span> <span class="token string">&quot;创建用户失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">newUser</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Callback</span> successCallback<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Callback</span> errorCallback<span class="token punctuation">)</span> throwsJSONException <span class="token punctuation">{</span>
    <span class="token class-name">JSONObject</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">JSONObject</span> head <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">JSONObject</span> body <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    head<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ConsumerId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    head<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ConsumerSeqNo&quot;</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    head<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;RequestDate&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyyMMdd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    head<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;RequestTime&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;HHmmss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    head<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;TransServiceCode&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;que012_esb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    body<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;APPLYCHANNELCODE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    body<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;CONFERUNIID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;13001234567&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;Head&quot;</span><span class="token punctuation">,</span> head<span class="token punctuation">)</span><span class="token punctuation">;</span>
    params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;Body&quot;</span><span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">HttpService</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>
            <span class="token class-name">AnyChatTool</span><span class="token punctuation">.</span>sHostUrl<span class="token punctuation">,</span>
            <span class="token keyword">null</span><span class="token punctuation">,</span>
            params<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">RequestCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSucceed</span><span class="token punctuation">(</span><span class="token class-name">String</span> data<span class="token punctuation">,</span> <span class="token class-name">String</span> json<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token class-name">JSONObject</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">JSONObject</span> responseHEAD <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">optJSONObject</span><span class="token punctuation">(</span><span class="token string">&quot;Head&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;000000&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>responseHEAD<span class="token punctuation">.</span><span class="token function">optString</span><span class="token punctuation">(</span><span class="token string">&quot;ReturnCode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token class-name">JSONObject</span> responseEntity <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">optJSONObject</span><span class="token punctuation">(</span><span class="token string">&quot;Body&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            anyChatTool<span class="token punctuation">.</span><span class="token function">loginEx</span><span class="token punctuation">(</span>responseEntity<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;IP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>responseEntity<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;PORT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    responseEntity<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;USERNAME&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>responseEntity<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;USERID&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    responseEntity<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;USERID&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    responseEntity<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;APPID&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>responseEntity<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;TIMESTAMP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    responseEntity<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;PASSWORD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    successCallback<span class="token punctuation">,</span>
                                    errorCallback<span class="token punctuation">,</span>
                                    handler<span class="token punctuation">,</span>
                                    <span class="token string">&quot;&quot;</span>
                            <span class="token punctuation">)</span><span class="token punctuation">;</span>
                            anyChatTool<span class="token punctuation">.</span>userFlag <span class="token operator">=</span> responseEntity<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;USERFLAG&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            anyChatTool<span class="token punctuation">.</span>judgeFlag <span class="token operator">=</span> responseEntity<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;JUDGEFLAG&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            anyChatTool<span class="token punctuation">.</span>conferID <span class="token operator">=</span> responseEntity<span class="token punctuation">.</span><span class="token function">optString</span><span class="token punctuation">(</span><span class="token string">&quot;CONFERID&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            errorCallback<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">getErrorWritableMap</span><span class="token punctuation">(</span>responseHEAD<span class="token punctuation">.</span><span class="token function">optStrin</span><span class="token punctuation">(</span><span class="token string">&quot;ReturnCode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> responseHEAD<span class="token punctuation">.</span><span class="token function">optString</span><span class="token punctuation">(</span><span class="token string">&quot;ReturnMessage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JSONException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        errorCallback<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">getErrorWritableMap</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>RESLUT_ERROR<span class="token punctuation">,</span> <span class="token string">&quot;返回参解析异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFail</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">&quot;createUser&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onFail message: &quot;</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">&quot;|| code :  &quot;</span> <span class="token operator">+</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>申请anyChat用户成功后会返回anyChat多媒体P端的地址等信息，用于（<code>anyChatTool.loginEx</code>）登录anyChat。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//android\react-native-anychat\src\main\java\com\AnyChatTool.java</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">loginEx</span><span class="token punctuation">(</span><span class="token class-name">String</span> anychaturl<span class="token punctuation">,</span> <span class="token keyword">int</span> anychatport<span class="token punctuation">,</span> <span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token keyword">int</span> userId<span class="token punctuation">,</span> <span class="token class-name">Stringstruserid</span><span class="token punctuation">,</span> <span class="token class-name">String</span> appid<span class="token punctuation">,</span> <span class="token keyword">int</span> timestemp<span class="token punctuation">,</span> <span class="token class-name">String</span> sigstr<span class="token punctuation">,</span> <span class="token class-name">Callback</span> successCallback<span class="token punctuation">,</span> <span class="token class-name">Callback</span> errorCallback<span class="token punctuation">,</span> <span class="token class-name">Handlerhandler</span><span class="token punctuation">,</span> <span class="token class-name">String</span> strparam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>successCallback <span class="token operator">=</span> successCallback<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>errorCallback <span class="token operator">=</span> errorCallback<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handler <span class="token operator">=</span> handler<span class="token punctuation">;</span>
    anyChatSDK<span class="token punctuation">.</span><span class="token class-name">Logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    anyChatSDK<span class="token punctuation">.</span><span class="token class-name">Connect</span><span class="token punctuation">(</span>anychaturl<span class="token punctuation">,</span> anychatport<span class="token punctuation">)</span><span class="token punctuation">;</span>
    anyChatSDK<span class="token punctuation">.</span><span class="token class-name">LoginEx</span><span class="token punctuation">(</span>userName<span class="token punctuation">,</span> userId<span class="token punctuation">,</span> struserid<span class="token punctuation">,</span> appid<span class="token punctuation">,</span> timestemp<span class="token punctuation">,</span> sigstr<span class="token punctuation">,</span> strparam<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="onanychatmessage-anychat消息事件"><a href="#onanychatmessage-anychat消息事件" aria-hidden="true" class="header-anchor">#</a> OnAnyChatMessage anyChat消息事件</h2> <p><code>anyChatSDK.Connect</code>执行成功后会收到一个<code>OnAnyChatConnectMessage</code>消息<div style="display:inline-block;"><button type="button" class="ant-btn ant-btn-primary" style="background-image:linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%);color:black;border:black;"><span>click me</span></button> <!----></div></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//android\react-native-anychat\src\main\java\com\AnyChatTool.java</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">OnAnyChatConnectMessage</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> bSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">&quot;fgq&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OnAnyChatConnectMessage==连接服务器成功&quot;</span> <span class="token operator">+</span> bSuccess<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        isLogin <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">&quot;fgq&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OnAnyChatConnectMessage==连接服务器失败&quot;</span> <span class="token operator">+</span> bSuccess<span class="token punctuation">)</span><span class="token punctuation">;</span>
        errorCallback<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">getErrorWritableMap</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>RESLUT_ERROR<span class="token punctuation">,</span> <span class="token string">&quot;失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mTimerCheckAv <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            mTimerCheckAv<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>anyChatSDK.LoginEx</code>执行成功后会收到一个<code>OnAnyChatLoginMessage</code>消息,并执行<code>waitEnterRoom</code>准备创建视频</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//android\react-native-anychat\src\main\java\com\AnyChatTool.java</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">OnAnyChatLoginMessage</span><span class="token punctuation">(</span><span class="token keyword">int</span> dwUserId<span class="token punctuation">,</span> <span class="token keyword">int</span> dwErrorCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dwErrorCode <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        isLogin <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token function">waitEnterRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">&quot;fgq&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OnAnyChatLoginMessage==登录成功  dwUserId：&quot;</span> <span class="token operator">+</span> dwUserId <span class="token operator">+</span> <span class="token string">&quot;   dwErrorCode&quot;</span> <span class="token operator">+</span> dwErrorCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">&quot;fgq&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OnAnyChatLoginMessage==登录失败  dwUserId：&quot;</span> <span class="token operator">+</span> dwUserId <span class="token operator">+</span> <span class="token string">&quot;   dwErrorCode&quot;</span> <span class="token operator">+</span> dwErrorCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        errorCallback<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">getErrorWritableMap</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>RESLUT_ERROR<span class="token punctuation">,</span> <span class="token string">&quot;失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/appVideoFlowDoc/startVideo/" class="prev">
          发起视频
        </a></span> <span class="next"><a href="/appVideoFlowDoc/createVideo/">
          创建视频
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/appVideoFlowDoc/assets/js/app.35f13f20.js" defer></script><script src="/appVideoFlowDoc/assets/js/2.b1ca60d8.js" defer></script><script src="/appVideoFlowDoc/assets/js/27.e1622741.js" defer></script><script src="/appVideoFlowDoc/assets/js/16.e0a4fa88.js" defer></script>
  </body>
</html>
