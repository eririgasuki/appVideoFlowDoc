<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>创建视频 | 手机银行APP云柜文档</title>
    <meta name="description" content="quick start for APP cloud teller workflow ">
    
    
    <link rel="preload" href="/appVideoFlowDoc/assets/css/0.styles.c89d3280.css" as="style"><link rel="preload" href="/appVideoFlowDoc/assets/js/app.35f13f20.js" as="script"><link rel="preload" href="/appVideoFlowDoc/assets/js/2.b1ca60d8.js" as="script"><link rel="preload" href="/appVideoFlowDoc/assets/js/21.4dcf174f.js" as="script"><link rel="preload" href="/appVideoFlowDoc/assets/js/16.e0a4fa88.js" as="script"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/10.07604a7d.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/11.5b2b976a.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/12.35972648.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/13.8cdd43a4.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/14.68addcac.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/15.1844d6fb.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/17.ca0bf5b2.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/18.54f91839.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/19.c687add5.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/20.f625b327.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/22.ccb9c454.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/23.e9ccb295.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/24.74527e2c.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/25.2cfb1549.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/26.012f3180.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/27.e1622741.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/28.21947846.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/29.62ffbc35.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/3.9fbadc31.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/30.b495a823.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/31.d7302fc2.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/32.8b01f34e.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/4.8a2a600a.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/5.8a639e4d.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/6.7af3c09c.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/7.680c50ef.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/8.b519c19a.js"><link rel="prefetch" href="/appVideoFlowDoc/assets/js/9.7435ab7e.js">
    <link rel="stylesheet" href="/appVideoFlowDoc/assets/css/0.styles.c89d3280.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/appVideoFlowDoc/" class="home-link router-link-active"><!----> <span class="site-name">手机银行APP云柜文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>初识手机云柜</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/appVideoFlowDoc/guide/" class="sidebar-link">介绍</a></li><li><a href="/appVideoFlowDoc/appFlow/" class="sidebar-link">界面操作流程</a></li><li><a href="/appVideoFlowDoc/flowChart/" class="sidebar-link">逻辑流程图</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>视频银行流程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/appVideoFlowDoc/preface/" class="sidebar-link">前言</a></li><li><a href="/appVideoFlowDoc/entrance/" class="sidebar-link">视频入口</a></li><li><a href="/appVideoFlowDoc/startVideo/" class="sidebar-link">发起视频</a></li><li><a href="/appVideoFlowDoc/requestAcct/" class="sidebar-link">申请用户</a></li><li><a href="/appVideoFlowDoc/createVideo/" class="active sidebar-link">创建视频</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/appVideoFlowDoc/createVideo/#createvideo-esb-创建视频" class="sidebar-link">createvideo_esb 创建视频</a></li><li class="sidebar-sub-header"><a href="/appVideoFlowDoc/createVideo/#enter-room-进入视频房间" class="sidebar-link">enter_room 进入视频房间</a></li><li class="sidebar-sub-header"><a href="/appVideoFlowDoc/createVideo/#show-video-展示视频" class="sidebar-link">show_video 展示视频</a></li></ul></li><li><a href="/appVideoFlowDoc/business/" class="sidebar-link">交易流程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>交易开发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/appVideoFlowDoc/workflow/env.html" class="sidebar-link">环境准备</a></li><li><a href="/appVideoFlowDoc/workflow/dev.html" class="sidebar-link">开发</a></li><li><a href="/appVideoFlowDoc/workflow/debug.html" class="sidebar-link">调试</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="createvideo-esb-创建视频"><a href="#createvideo-esb-创建视频" aria-hidden="true" class="header-anchor">#</a> createvideo_esb 创建视频</h2> <p>anyChat用户登录成功后,会执行<code>waitEnterRoom</code>方法创建视频</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//android\react-native-anychat\src\main\java\com\AnyChatTool.java</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">waitEnterRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">JSONObject</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">JSONObject</span> head <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">JSONObject</span> body <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
    head<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ConsumerId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    head<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ConsumerSeqNo&quot;</span><span class="token punctuation">,</span> <span class="token function">getUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    head<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;RequestDate&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyyMMdd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    head<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;RequestTime&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;HHmmss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    head<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;TdgBrah&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;12001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    head<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;TransServiceCode&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;createvideo_esb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    body<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;DeviceType&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;online&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    body<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;DeviceNum&quot;</span><span class="token punctuation">,</span> userFlag<span class="token punctuation">)</span><span class="token punctuation">;</span>
    body<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;USERFLAG&quot;</span><span class="token punctuation">,</span> userFlag<span class="token punctuation">)</span><span class="token punctuation">;</span>
    body<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;JUDGEFLAG&quot;</span><span class="token punctuation">,</span> judgeFlag<span class="token punctuation">)</span><span class="token punctuation">;</span>
    body<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;CONFERID&quot;</span><span class="token punctuation">,</span> conferID<span class="token punctuation">)</span><span class="token punctuation">;</span>
    body<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;QUEUETYPE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;Head&quot;</span><span class="token punctuation">,</span> head<span class="token punctuation">)</span><span class="token punctuation">;</span>
    params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;Body&quot;</span><span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HttpService</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>
                <span class="token class-name">Constant</span><span class="token punctuation">.</span>HOST_URL<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                params<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">RequestCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSucceed</span><span class="token punctuation">(</span><span class="token class-name">String</span> data<span class="token punctuation">,</span> <span class="token class-name">String</span> json<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            <span class="token class-name">JSONObject</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name">JSONObject</span> responseHEAD <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">optJSONObject</span><span class="token punctuation">(</span><span class="token string">&quot;Head&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;000000&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>responseHEAD<span class="token punctuation">.</span><span class="token function">optString</span><span class="token punctuation">(</span><span class="token string">&quot;ReturnCode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                <span class="token class-name">JSONObject</span> responseEntity <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">optJSONObject</span><span class="token punctuation">(</span><span class="token string">&quot;Body&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                sid <span class="token operator">=</span> responseEntity<span class="token punctuation">.</span><span class="token function">optString</span><span class="token punctuation">(</span><span class="token string">&quot;sid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                sQueueno <span class="token operator">=</span> responseEntity<span class="token punctuation">.</span><span class="token function">optString</span><span class="token punctuation">(</span><span class="token string">&quot;QUEUENO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                groupId <span class="token operator">=</span> responseEntity<span class="token punctuation">.</span><span class="token function">optString</span><span class="token punctuation">(</span><span class="token string">&quot;groupId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                agentId <span class="token operator">=</span> responseEntity<span class="token punctuation">.</span><span class="token function">optString</span><span class="token punctuation">(</span><span class="token string">&quot;agentId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                msgId <span class="token operator">=</span> responseEntity<span class="token punctuation">.</span><span class="token function">optString</span><span class="token punctuation">(</span><span class="token string">&quot;msgId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                isInQuene <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                                errorCallback<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">getErrorWritableMap</span><span class="token punctuation">(</span>responseHEAD<span class="token punctuation">.</span><span class="token function">optStrin</span><span class="token punctuation">(</span><span class="token string">&quot;ReturnCode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                        responseHEAD<span class="token punctuation">.</span><span class="token function">optString</span><span class="token punctuation">(</span><span class="token string">&quot;ReturnMessage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JSONException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            errorCallback<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">getErrorWritableMap</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>RESLUT_ERROR<span class="token punctuation">,</span> <span class="token string">&quot;返参数解析异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFail</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">&quot;createUser&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onFail message: &quot;</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">&quot;|| code :  &quot;</span> <span class="token operator">+</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        errorCallback<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">getErrorWritableMap</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>RESLUT_ERROR<span class="token punctuation">,</span> <span class="token string">&quot;创建失&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JSONException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        errorCallback<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">getErrorWritableMap</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>RESLUT_ERROR<span class="token punctuation">,</span> <span class="token string">&quot;传入参数异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="enter-room-进入视频房间"><a href="#enter-room-进入视频房间" aria-hidden="true" class="header-anchor">#</a> enter_room 进入视频房间</h2> <p><code>createvideo_esb</code>接口会通知座席端振铃,坐席接听振铃后,anyChat会通过<code>OnAnyChatTransBuffer</code>事件,通知双方<code>enter_room</code>进入视频房间<div style="display:inline-block;"><button type="button" class="ant-btn ant-btn-primary" style="background-image:linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%);color:black;border:black;"><span>click me</span></button> <!----></div></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//android\react-native-anychat\src\main\java\com\AnyChatTool.java</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">OnAnyChatTransBuffer</span><span class="token punctuation">(</span><span class="token keyword">int</span> dwUserid<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> lpBuf<span class="token punctuation">,</span> <span class="token keyword">int</span> dwLen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>lpBuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">JSONObject</span> json <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> commandType <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">optString</span><span class="token punctuation">(</span><span class="token string">&quot;commandType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;enter_room&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>commandType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            isInQuene <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> roomId <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">optString</span><span class="token punctuation">(</span><span class="token string">&quot;roomid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>successCallback<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">getSuccessWritableMap</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>RESLUT_SUCCESS<span class="token punctuation">,</span> <span class="token string">&quot;成功连远程正在进入房间&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;show_video&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>commandType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">JSONObject</span> cameraparam <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">optJSONObject</span><span class="token punctuation">(</span><span class="token string">&quot;Cameraparam&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            width <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>cameraparam<span class="token punctuation">.</span><span class="token function">optString</span><span class="token punctuation">(</span><span class="token string">&quot;camerawidth&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            height <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>cameraparam<span class="token punctuation">.</span><span class="token function">optString</span><span class="token punctuation">(</span><span class="token string">&quot;cameraheight&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            malv <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>cameraparam<span class="token punctuation">.</span><span class="token function">optString</span><span class="token punctuation">(</span><span class="token string">&quot;cameramalv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            zhenlv <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>cameraparam<span class="token punctuation">.</span><span class="token function">optString</span><span class="token punctuation">(</span><span class="token string">&quot;camerazhenlv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 回调给js</span>
    mCallBack<span class="token punctuation">.</span><span class="token function">doSomeThing</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当指令类型为<code>enter_room</code>的时候,会执行<code>this.successCallback.invoke();</code>RN层<code>AnyChat.enterLine</code>的成功回调,跳转到视频页面<code>router.load(&quot;tellerOperation&quot;)</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//src\pages\activity\home\cloudDots.js</span>
AnyChat<span class="token punctuation">.</span><span class="token function">enterLine</span> <span class="token punctuation">(</span> params<span class="token punctuation">,</span> <span class="token punctuation">(</span> <span class="token parameter">succ</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span> <span class="token string">'进线成功回调='</span><span class="token operator">+</span> succ <span class="token punctuation">)</span>
    router<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;tellerOperation&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        account<span class="token punctuation">:</span><span class="token string">&quot;liudabin&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> <span class="token parameter">err</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'进线失败'</span><span class="token punctuation">,</span> err <span class="token punctuation">)</span>
    $Toast<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'呼叫视频服务失败'</span><span class="token punctuation">)</span>
    _this<span class="token punctuation">.</span><span class="token function">unCallCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在<code>tellerOperation</code>页面中,会监听<code>RecivedPushNotification</code>事件来接收<code>OnAnyChatTransBuffer</code>的消息</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//src\pages\cloudTeller\tellerOperation\tellerOperation.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NativeModules<span class="token punctuation">,</span> NativeEventEmitter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-native'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> AnyChat <span class="token operator">=</span> NativeModules<span class="token punctuation">.</span>AnyChatPlugin<span class="token punctuation">;</span>
<span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>recognizerEventEmitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NativeEventEmitter</span><span class="token punctuation">(</span>AnyChat<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>recognizerEventEmitter<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">'RecivedPushNotification'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RecivedPushNotification<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在android层,通过执行<code>OnAnyChatTransBuffer</code>方法中的<code>mCallBack.doSomeThing(str)</code>来传递消息</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//android\react-native-anychat\src\main\java\com\utils\Constant.java</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Constant</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> EVENT_NAME <span class="token operator">=</span> <span class="token string">&quot;RecivedPushNotification&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//android\react-native-anychat\src\main\java\com\AnyChatMoudle.java</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomeThing</span><span class="token punctuation">(</span><span class="token class-name">String</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mContext<span class="token punctuation">.</span><span class="token function">getJSModule</span><span class="token punctuation">(</span><span class="token class-name">DeviceEventManagerModule</span><span class="token punctuation">.</span><span class="token class-name">RCTDeviceEventEmitter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>EVENT_NAME<span class="token punctuation">,</span> string<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个时候<code>tellerOperation</code>页面中就会通过<code>RecivedPushNotification</code>事件,监听到消息指令为<code>enter_room</code>的消息,然后调用<code>AnyChat.enterRoom</code>进入视频房间</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//src\pages\cloudTeller\tellerOperation\tellerOperation.js</span>
<span class="token function">RecivedPushNotification</span><span class="token punctuation">(</span><span class="token parameter">eventData</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span> <span class="token string">'接受推送消息:'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>eventData<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token keyword">let</span> ed <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>eventData<span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token keyword">let</span> commandType <span class="token operator">=</span> ed<span class="token punctuation">.</span>CommandType<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'enter_room'</span> <span class="token operator">==</span> commandType<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> roomId <span class="token operator">=</span> ed<span class="token punctuation">.</span>roomid<span class="token punctuation">;</span>
        <span class="token keyword">let</span> params <span class="token operator">=</span><span class="token punctuation">{</span>
            roomId
        <span class="token punctuation">}</span>
        AnyChat<span class="token punctuation">.</span><span class="token function">enterRoom</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token punctuation">(</span> <span class="token parameter">succ</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'进入房间成功，返回值：'</span><span class="token punctuation">,</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>succ<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span> <span class="token parameter">err</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'进入房间失败，返回值：'</span><span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//android\react-native-anychat\src\main\java\com\AnyChatMoudle.java</span>
<span class="token annotation punctuation">@ReactMethod</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">enterRoom</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">ReadableMap</span> readableMap<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Callback</span> successCallback<span class="token punctuation">,</span> finalCallback errorCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ReadableNativeMap</span> readableNativeMap <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ReadableNativeMap</span><span class="token punctuation">)</span> readableMap<span class="token punctuation">;</span>
    <span class="token class-name">Map</span> map <span class="token operator">=</span> readableNativeMap<span class="token punctuation">.</span><span class="token function">toHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> roomIdtemp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;roomId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>roomIdtemp <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        errorCallback<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">getErrorWritableMap</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>RESLUT_ERROR<span class="token punctuation">,</span> <span class="token string">&quot;参数不对&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> roomId <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>roomIdtemp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getCurrentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runOnUiThread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">RxPermissions</span><span class="token punctuation">.</span><span class="token function">getIntance</span><span class="token punctuation">(</span><span class="token function">getCurrentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>CAMERA_PERMISSIONS<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Boolean</span> aBoolean<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>aBoolean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">final</span> <span class="token class-name">Handler</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                anyChatTool<span class="token punctuation">.</span><span class="token function">enterRoom</span><span class="token punctuation">(</span><span class="token function">getCurrentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> roomId<span class="token punctuation">,</span> handler<span class="token punctuation">,</span>successCallback<span class="token punctuation">,</span> errorCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                                errorCallback<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">getErrorWritableMap</span><span class="token punctuation">(</span><span class="token class-name">ConstantPERMISSION_DENIED</span><span class="token punctuation">,</span> <span class="token string">&quot;权限不足&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//android\react-native-anychat\src\main\java\com\AnyChatTool.java</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">enterRoom</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Activity</span> context<span class="token punctuation">,</span> <span class="token keyword">int</span> roomId<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Handler</span> handler<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Callback</span> successCallback<span class="token punctuation">,</span> <span class="token class-name">Callback</span> errorCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handler <span class="token operator">=</span> handler<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>successCallback <span class="token operator">=</span> successCallback<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>errorCallback <span class="token operator">=</span> errorCallback<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>
    anyChatSDK<span class="token punctuation">.</span><span class="token class-name">EnterRoom</span><span class="token punctuation">(</span>roomId<span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="show-video-展示视频"><a href="#show-video-展示视频" aria-hidden="true" class="header-anchor">#</a> show_video 展示视频</h2> <p>当用户和坐席双方都进入视频房间后,anyChat会通过<code>OnAnyChatTransBuffer</code>事件,通知双方<code>show_video</code>拉起视频
拉起视频时需要传入远程id,和接收双方视频流的容器<code>&lt;AnyChatView&gt;</code><div style="display:inline-block;"><button type="button" class="ant-btn ant-btn-primary" style="background-image:linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%);color:black;border:black;"><span>click me</span></button> <!----></div></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">RecivedPushNotification</span><span class="token punctuation">(</span><span class="token parameter">eventData</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span> <span class="token string">'接受推送消息:'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>eventData<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token keyword">let</span> ed <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>eventData<span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token keyword">let</span> commandType <span class="token operator">=</span> ed<span class="token punctuation">.</span>CommandType<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'show_video'</span> <span class="token operator">==</span> commandType<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> remoteId <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>ed<span class="token punctuation">.</span>useridlist<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
            userNativeViewId<span class="token punctuation">:</span> <span class="token string">'userNativeViewId'</span><span class="token punctuation">,</span>
            remoteNativeViewId<span class="token punctuation">:</span><span class="token string">'remoteNativeViewId'</span><span class="token punctuation">,</span>
            remoteId
        <span class="token punctuation">}</span>
        AnyChat<span class="token punctuation">.</span><span class="token function">anyChatPlay</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token punctuation">(</span> <span class="token parameter">succ</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span> <span class="token string">'开启视频成功，返回值：'</span><span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>succ<span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token punctuation">,</span><span class="token punctuation">(</span> <span class="token parameter">err</span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span> <span class="token string">'开启视频失败，返回值：'</span><span class="token operator">+</span> err <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">&lt;</span>AnyChatView style<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>userNativeView<span class="token punctuation">}</span> nativeId<span class="token operator">=</span><span class="token string">'userNativeViewId'</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>AnyChatView<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>AnyChatView style<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>remoteNativeView<span class="token punctuation">}</span> nativeId<span class="token operator">=</span><span class="token string">'remoteNativeViewId'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>AnyChatView<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//android\react-native-anychat\src\main\java\com\AnyChatMoudle.java</span>
<span class="token annotation punctuation">@ReactMethod</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">anyChatPlay</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">ReadableMap</span> readableMap<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Callback</span> successCallback<span class="token punctuation">,</span> finalCallback errorCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ReadableNativeMap</span> readableNativeMap <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ReadableNativeMap</span><span class="token punctuation">)</span> readableMap<span class="token punctuation">;</span>
    <span class="token class-name">Map</span> map <span class="token operator">=</span> readableNativeMap<span class="token punctuation">.</span><span class="token function">toHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> userNativeViewId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;userNativeViewId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> remoteNativeViewId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;remoteNativeViewId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> remoteIdtemp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;remoteId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> remoteId <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>remoteIdtemp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">MySurfaceView</span> userSurface <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MySurfaceView</span><span class="token punctuation">)</span> <span class="token class-name">ReactFindViewUtil</span><span class="token punctuation">.</span><span class="token function">findVie</span><span class="token punctuation">(</span><span class="token function">getCurrentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDecorView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userNativeViewId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">MySurfaceView</span> remoteSurface <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MySurfaceView</span><span class="token punctuation">)</span> <span class="token class-name">ReactFindViewUtil</span><span class="token punctuation">.</span><span class="token function">findVie</span><span class="token punctuation">(</span><span class="token function">getCurrentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDecorView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> remoteNativeViewId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getCurrentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runOnUiThread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">RxPermissions</span><span class="token punctuation">.</span><span class="token function">getIntance</span><span class="token punctuation">(</span><span class="token function">getCurrentActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>CAMERA_PERMISSIONS<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Boolean</span> aBoolean<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>aBoolean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                anyChatTool<span class="token punctuation">.</span><span class="token function">anyChatPlay</span><span class="token punctuation">(</span>userSurface<span class="token punctuation">,</span> remoteSurface<span class="token punctuation">,</span> remoteId<span class="token punctuation">,</span>successCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                                errorCallback<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">getErrorWritableMap</span><span class="token punctuation">(</span><span class="token class-name">ConstantPERMISSION_DENIED</span><span class="token punctuation">,</span> <span class="token string">&quot;权限不足&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//android\react-native-anychat\src\main\java\com\AnyChatTool.java</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">anyChatPlay</span><span class="token punctuation">(</span><span class="token class-name">SurfaceView</span> userSurface<span class="token punctuation">,</span> <span class="token class-name">SurfaceView</span> remoteSurface<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token keyword">int</span> remoteId<span class="token punctuation">,</span><span class="token keyword">final</span> <span class="token class-name">Callback</span> successCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ApplyVideoConfig</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mUserSurface <span class="token operator">=</span> userSurface<span class="token punctuation">;</span>
    <span class="token class-name">AnyChatCoreSDK</span><span class="token punctuation">.</span>mCameraHelper<span class="token punctuation">.</span><span class="token class-name">SetContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mUserSurface<span class="token punctuation">.</span><span class="token function">getHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addCallback</span><span class="token punctuation">(</span><span class="token class-name">AnyChatCoreSDK</span><span class="token punctuation">.</span>mCameraHelper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AnyChatCoreSDK</span><span class="token punctuation">.</span>mCameraHelper<span class="token punctuation">.</span><span class="token class-name">SelectVideoCapture</span><span class="token punctuation">(</span><span class="token class-name">AnyChatCoreSDK</span><span class="token punctuation">.</span>mCameraHelperCAMERA_FACING_FRONT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    anyChatSDK<span class="token punctuation">.</span><span class="token class-name">UserCameraControl</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> OPEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
    anyChatSDK<span class="token punctuation">.</span><span class="token class-name">UserSpeakControl</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> OPEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mUserSurface<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>remoteId <span class="token operator">=</span> remoteId<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mRemoteSurface <span class="token operator">=</span> remoteSurface<span class="token punctuation">;</span>
    index <span class="token operator">=</span> anyChatSDK<span class="token punctuation">.</span>mVideoHelper<span class="token punctuation">.</span><span class="token function">bindVideo</span><span class="token punctuation">(</span>mRemoteSurface<span class="token punctuation">.</span><span class="token function">getHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    anyChatSDK<span class="token punctuation">.</span>mVideoHelper<span class="token punctuation">.</span><span class="token class-name">SetVideoUser</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> remoteId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    anyChatSDK<span class="token punctuation">.</span><span class="token class-name">UserCameraControl</span><span class="token punctuation">(</span>remoteId<span class="token punctuation">,</span> OPEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
    anyChatSDK<span class="token punctuation">.</span><span class="token class-name">UserSpeakControl</span><span class="token punctuation">(</span>remoteId<span class="token punctuation">,</span> OPEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mRemoteSurface<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">registSreenStatusReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    isOnVideo <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    successCallback<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">AnyChatMoudle</span><span class="token punctuation">.</span><span class="token function">getSuccessWritableMap</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span>RESLUT_SUCCESS<span class="token punctuation">,</span> <span class="token string">&quot;成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>AnyChat.anyChatPlay</code>执行成功后,即可在AnyChatView中看到对应的视频了<div style="display:inline-block;"><button type="button" class="ant-btn ant-btn-primary" style="background-image:linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%);color:black;border:black;"><span>click me</span></button> <!----></div></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/appVideoFlowDoc/requestAcct/" class="prev">
          申请用户
        </a></span> <span class="next"><a href="/appVideoFlowDoc/business/">
          交易流程
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/appVideoFlowDoc/assets/js/app.35f13f20.js" defer></script><script src="/appVideoFlowDoc/assets/js/2.b1ca60d8.js" defer></script><script src="/appVideoFlowDoc/assets/js/21.4dcf174f.js" defer></script><script src="/appVideoFlowDoc/assets/js/16.e0a4fa88.js" defer></script>
  </body>
</html>
